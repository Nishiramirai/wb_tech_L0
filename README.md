# WB Техношкола Golang L0

Демонстрационный микросервис для обработки и отображения данных о заказах. Сервис реализует полный цикл обработки данных: получение сообщений из Kafka, сохранение в PostgreSQL, кэширование в памяти и предоставление данных через HTTP API с веб-интерфейсом.

## Стек технологий
* **Основной язык:** Go
* **Веб-сервер:** `net/http`
* **Логирование:** `uber-go/zap`
* **База данных:** PostgreSQL (`jackc/pgx/v5`)
* **Брокер сообщений:** Kafka (`segmentio/kafka-go`)
* **Кэширование:** In-memory кэш
* **Миграции БД:** SQL-скрипты
* **Конфиг:** godotenv (`joho/godotenv`)
* **Развертывание:** Docker и Docker Compose

## Архитектура проекта
```
wb-orders-service/
├── cmd/
│   └── main.go                 # Точка входа приложения
├── internal/
│   ├── app/
│   │   ├── model/
│   │   │   └── models.go       # Модели данных (структуры)
│   │   └── service/
│   │       └── service.go      # Бизнес-логика приложения
│   ├── cache/
│   │   └── cache.go            # In-memory кэш заказов
│   ├── configs/
│   │   └── config.go           # Конфигурация приложения
│   ├── db/
│   │   └── db.go               # Работа с PostgreSQL
│   ├── http/
│   │   ├── handlers.go         # HTTP обработчики
│   │   └── server.go           # HTTP сервер
│   └── kafka/
│       └── consumer.go         # Kafka consumer
├── migrations/
│   ├── 000001_create_orders_tables.up.sql    # Миграция БД (создание)
│   └── 000001_create_orders_tables.down.sql  # Миграция БД (удаление)
├── web/
│   └── index.html              # Веб-интерфейс
├── test/
│   └── producer/
│       └── main.go             # Тестовый producer для Kafka
├── docker-compose.yaml         # Docker Compose конфигурация
├── Dockerfile                  # Docker образ приложения
├── entrypoint.sh               # Скрипт запуска в контейнере
├── Makefile                    # Управление проектом
├── go.mod                      # Go модули
├── go.sum                      # Go зависимости
└── README.md                   # Документация проекта
```

## Запуск

### Требования

Для запуска проекта понадобится установленный **Docker** и **Docker Compose**.

### Шаги запуска

1.  **Создать файл `.env`**.
    Сделать это можно создав и вручную заполнив файл `.env` по указанному шаблону
    ```
    APP_PORT=8081
    CACHE_SIZE=100

    KAFKA_BROKERS=kafka:29092
    KAFKA_TOPIC=orders
    KAFKA_GROUP_ID=order-service-group

    POSTGRES_USER=demo_user
    POSTGRES_PASSWORD=demo_password
    POSTGRES_DB=orders_db
    POSTGRES_PORT=5432
    POSTGRES_HOST=db
    ```

    или скопировав `.env.example` в `.env`.

    ```bash
    cp .env.example .env
    ```

2.  **Сборка и запуск контейнеров.**
    Приложение и все необходимые для его работы сервисы запускаются с помощью docker compose, также есть Makefile, с помощью которого проект можно запустить командой make run.

    ```bash
    make run
    ```

    Эта команда автоматически соберёт необходимые Docker-образы и запустит контейнеры в фоновом режиме.

---
## Управление приложением

Для управления жизненным циклом приложения используется `make` со следующими целями:
* **`make run`**: Запускает все сервисы в фоновом режиме. Если образы не были собраны, они будут собраны автоматически.
* **`make build`**: Собирает только Docker-образ приложения.
* **`make send`**: Отправляет тестовые данные в брокер сообщений Kafka, запуская временный контейнер.
* **`make logs`**: Просматривает логи основного контейнера `app` в реальном времени.
* **`make stop`**: Останавливает и удаляет все запущенные контейнеры.
* **`make clean`**: Удаляет неиспользуемые Docker-образы и остановленные контейнеры.

---
## API и Веб-интерфейс

После запуска сервиса с ним можно взаимодействовать с помощью REST API и веб-интерфейса.

### Веб-интерфейс
Веб-интерфейс доступен по адресу **`http://localhost:8081`**.
Здесь можно посмотреть данные о заказе в формате JSON по его `order_uid`.

### API
Сервис предоставляет HTTP API для получения данных.
* **`GET /orders/{order_uid}`**
  * **Описание**: Получение информации о конкретном заказе по его `order_uid`.
  * **Пример**: `curl http://localhost:8081/orders/b563feb7b2b84b6test`
